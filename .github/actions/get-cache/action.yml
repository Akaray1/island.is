name: 'Get Cache Keys'
description: 'Action to get cache'
inputs:
  enable-node-modules:
    description: 'Get node modules cache'
    default: 'false'
  enable-mobile-node-modules:
    description: 'Get mobile node modules'
    default: 'false'
  enable-generated-files:
    description: 'Get generated files'
    default: 'false'
  enable-cypress:
    description: 'Get cypress'
    default: 'false'
  keys:
    description: 'Keys'
    default: 'false'
  cypress-path:
    description: 'Path to cypress'
    default: '/github/home/.cache/Cypress'
outputs:
  keys:
    description: 'Keys'
    value: ${{ steps.get-cache-keys.outputs._CACHE_KEYS }}
runs:
  using: 'composite'
  steps:
    - uses: cue-lang/setup-cue@v1.0.0
    - shell: bash
      env:
        CACHE_HASHES: ${{ inputs.keys }}
        ENABLE_NODE_MODULES: ${{ inputs.enable-node-modules }}
        ENABLE_MOBILE_NODE_MODULES: ${{ inputs.enable-mobile-node-modules }}
        ENABLE_GENERATED_FILES: ${{ inputs.enable-generated-files }}
        ENABLE_CYPRESS: ${{ inputs.enable-cypress }}
      id: get-cache-keys
      run: |
        node scripts/ci/cache/get-hashes.mjs
    - name: Generate Dynamic Steps
      id: generate-steps
      shell: bash
      env:
        ENABLE_NODE_MODULES: ${{ inputs.enable-node-modules }}
        ENABLE_MOBILE_NODE_MODULES: ${{ inputs.enable-mobile-node-modules }}
        ENABLE_GENERATED_FILES: ${{ inputs.enable-generated-files }}
        ENABLE_CYPRESS: ${{ inputs.enable-cypress }}
        CYPRESS_PATH: ${{ inputs.cypress-path }}
        _CACHE_KEYS: ${{ steps.get-cache-keys.outputs._CACHE_KEYS }}
        _INIT_CACHE: ${{ steps.get-cache-keys.outputs._INIT_CACHE }}
        YAML_FILE: ./.tmp-dynamic-cache/action.yml
      run: |
        node scripts/ci/cache/generate-cache-steps.mjs
    - name: Run cache workflow
      id: run-cache
      uses: ./.tmp-dynamic-cache
    - name: Cleanup cache workflow
      shell: bash
      run: rm -rf ./.tmp-dynamic-cache
    - name: Cache actions
      id: cache-actions
      shell: bash
      env:
        ENABLE_NODE_MODULES: ${{ inputs.enable-node-modules }}
        ENABLE_MOBILE_NODE_MODULES: ${{ inputs.enable-mobile-node-modules }}
        ENABLE_GENERATED_FILES: ${{ inputs.enable-generated-files }}
        ENABLE_CYPRESS: ${{ inputs.enable-cypress }}
        CYPRESS_PATH: ${{ inputs.cypress-path }}
        _CACHE_KEYS: ${{ steps.get-cache-keys.outputs._CACHE_KEYS }}
        _INIT_CACHE: ${{ steps.get-cache-keys.outputs._INIT_CACHE }}
      run: |
        ./scripts/ci/cache/cache-action.mjs
